# üõ∞Ô∏è Segmentation Plugin for QGIS

<div align="center">

![QGIS](https://img.shields.io/badge/QGIS-3.0+-589632.svg)
![Python](https://img.shields.io/badge/python-v3.8+-blue.svg)
![TensorFlow](https://img.shields.io/badge/TensorFlow-2.10.0-FF6F00.svg)
![License](https://img.shields.io/badge/license-GPL-green.svg)

<h3>üåç –ü–ª–∞–≥–∏–Ω QGIS –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã—Ö —Å–Ω–∏–º–∫–æ–≤</h3>

[–î–µ–º–æ](#-–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è) ‚Ä¢ [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞) ‚Ä¢ [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)

</div>

---

## üì∏ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

### üöÄ –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
<div align="center">
  <img src="gif/demo_first_run.gif" alt="–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫" width="80%">
</div>

### üñ•Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å
<div align="center">
  <img src="gif/demo_local_inference.gif" alt="–õ–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å" width="80%">
</div>

### üåê –ò–Ω—Ñ–µ—Ä–µ–Ω—Å —á–µ—Ä–µ–∑ API (render.com)
<div align="center">
  <img src="gif/demo_api_inference.gif" alt="API –∏–Ω—Ñ–µ—Ä–µ–Ω—Å" width="80%">
</div>

### üè† –õ–æ–∫–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥
<div align="center">
  <img src="gif/demo_local_backend.gif" alt="–õ–æ–∫–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥" width="80%">
</div>

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

<table>
<tr>
<td width="50%">

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **6 –∫–ª–∞—Å—Å–æ–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏** —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é
- **–õ–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å** –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- **API –∏–Ω—Ñ–µ—Ä–µ–Ω—Å** —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞** –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫** –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏

</td>
<td width="50%">

### üé® –ö–ª–∞—Å—Å—ã –æ–±—ä–µ–∫—Ç–æ–≤

| –ö–ª–∞—Å—Å | –¶–≤–µ—Ç | Hex |
|-------|------|-----|
| üè† –ó–¥–∞–Ω–∏—è | ![#3C1098](https://placehold.co/15x15/3C1098/3C1098.png) | `#3C1098` |
| üåç –ó–µ–º–ª—è | ![#8429F6](https://placehold.co/15x15/8429F6/8429F6.png) | `#8429F6` |
| üõ£Ô∏è –î–æ—Ä–æ–≥–∏ | ![#6EC1E4](https://placehold.co/15x15/6EC1E4/6EC1E4.png) | `#6EC1E4` |
| üå≥ –†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | ![#FEDD3A](https://placehold.co/15x15/FEDD3A/FEDD3A.png) | `#FEDD3A` |
| üíß –í–æ–¥–∞ | ![#E2A929](https://placehold.co/15x15/E2A929/E2A929.png) | `#E2A929` |
| ‚¨ú –ù–µ—Ä–∞–∑–º–µ—á–µ–Ω–Ω–æ–µ | ![#9B9B9B](https://placehold.co/15x15/9B9B9B/9B9B9B.png) | `#9B9B9B` |

</td>
</tr>
</table>

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph LR
    A[QGIS –†–∞—Å—Ç—Ä–æ–≤—ã–π —Å–ª–æ–π] --> B[Segmentation Plugin]
    B --> C{–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã}
    C -->|–õ–æ–∫–∞–ª—å–Ω—ã–π| D[TensorFlow Model<br/>–≤ .venv]
    C -->|API| E[–í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä<br/>FastAPI]
    D --> F[–°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π<br/>—Å–ª–æ–π]
    E --> F
    F --> G[–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è<br/>–≤ QGIS]
```

## üíª –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **QGIS** 3.0+
- **Windows** 10/11 (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
- **RAM** 4GB+
- **Disk** 2GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–∞

1. **–°–∫–∞—á–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```bash
   git clone https://github.com/yourusername/segmentation-qgis-plugin.git
   ```

2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ –ø–∞–ø–∫—É –ø–ª–∞–≥–∏–Ω–æ–≤ QGIS:**
   ```
   C:\Users\–ò–ú–Ø_–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø\AppData\Roaming\QGIS\QGIS3\profiles\default\python\plugins\segment\
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ QGIS –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–ª–∞–≥–∏–Ω:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ QGIS
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `–ú–æ–¥—É–ª–∏` ‚Üí `–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏`
   - –ù–∞–π–¥–∏—Ç–µ "Segmentation Plugin" –∏ –ø–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É

4. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:**
   - –ü–ª–∞–≥–∏–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ü–æ—è–≤–∏—Ç—Å—è –æ–∫–Ω–æ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - –ù–∞–∂–º–∏—Ç–µ "–î–∞" –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (5-10 –º–∏–Ω—É—Ç)

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø–ª–∞–≥–∏–Ω–∞

- –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É –ø–ª–∞–≥–∏–Ω–∞ –≤ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –ò–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ `–ú–æ–¥—É–ª–∏` ‚Üí `Segmentation Plugin`

### 2Ô∏è‚É£ –í—ã–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

- **–†–∞—Å—Ç—Ä–æ–≤—ã–π —Å–ª–æ–π:** –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–π –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤ QGIS
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —ç–∫—Å—Ç–µ–Ω—Ç:** –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å

### 3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏

#### üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏

- `best_model.h5` - –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ –∏–∑ –ø–∞–ø–∫–∏ `models/`
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥

### 4Ô∏è‚É£ –†–µ–∂–∏–º—ã –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞

#### üñ•Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å

- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å
- –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç CPU

#### üåê API –∏–Ω—Ñ–µ—Ä–µ–Ω—Å

- –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
  - –ü—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä: `https://dpo-segmentation-model.onrender.com`
  - –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä: `http://localhost:8080`

### 5Ô∏è‚É£ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|----------------------|
| **–†–∞–∑–º–µ—Ä –ø–∞—Ç—á–∞** | –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (128-512) | 256 |
| **–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π (1-4) | 2 |

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–∞

```
üìÅ segment/
‚îú‚îÄ‚îÄ üìÅ help/                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üìÅ i18n/                    # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üìÅ models/                  # –ú–æ–¥–µ–ª–∏ ML
‚îÇ   ‚îî‚îÄ‚îÄ üß† best_model.h5       # –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ üìÅ scripts/                 # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ üìÅ utils/                   # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ üîß model_loader.py     # –ó–∞–≥—Ä—É–∑—á–∏–∫ –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ üéØ prediction.py       # –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üñºÔ∏è image_utils.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ üë∑ worker.py           # –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ‚îÄ üìÅ portable_python/         # –ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–π Python (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ üìÅ .venv/                   # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ üêç SegmentationPlugin.py   # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å
‚îú‚îÄ‚îÄ üé® SegmentationPlugin_dialog.py # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ ‚öôÔ∏è config.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üöÄ create_env.bat          # –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ üìÑ metadata.txt            # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω–∞
```

### üîß –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞:

```bash
cd C:\Users\–ò–ú–Ø_–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø\AppData\Roaming\QGIS\QGIS3\profiles\default\python\plugins\segment
create_env.bat
```

### üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `config.py` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```python
# –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_MODEL_PATH = 'best_model.h5'

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
DEFAULT_PATCH_SIZE = 256
DEFAULT_SUBDIVISIONS = 2

# API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
DEFAULT_API_URL = 'http://localhost:8080'
```
